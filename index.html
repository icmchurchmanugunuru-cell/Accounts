<!DOCTYPE html>
<html lang="te" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    
    <!-- --- ULTIMATE SEO & KEYWORD OPTIMIZATION --- -->
    <!-- ‡∞Æ‡∞æ‡∞Æ‡∞æ, ‡∞®‡±Å‡∞µ‡±ç‡∞µ‡±Å ‡∞Ö‡∞°‡∞ø‡∞ó‡∞ø‡∞® ‡∞ï‡±Ä‡∞µ‡∞∞‡±ç‡∞°‡±ç‡∞∏‡±ç ‡∞Ö‡∞®‡±ç‡∞®‡±Ä ‡∞á‡∞ï‡±ç‡∞ï‡∞° ‡∞∏‡±Ü‡∞ü‡±ç ‡∞ö‡±á‡∞∂‡∞æ‡∞®‡±Å -->
    <meta name="google-site-verification" content="y2T6hgX4b-PQ7t6Ld2Kn4E2ppB6e2LSGnGifJpYCEMM" />
    
    <title>ICM Church Accounts | Manugunuru Accounts | ICM Accounts Ledger</title>
    
    <meta name="description" content="Access official ICM Church Accounts and financial ledger of Manugunuru. ICM Church Manugunuru accounts tracking donations and expenses for transparency.">
    
    <!-- ‡∞à ‡∞ï‡±Ä‡∞µ‡∞∞‡±ç‡∞°‡±ç‡∞∏‡±ç ‡∞®‡∞ø ‡∞¨‡∞ü‡±ç‡∞ü‡±á ‡∞ó‡±Ç‡∞ó‡±Å‡∞≤‡±ç ‡∞®‡∞ø‡∞®‡±ç‡∞®‡±Å ‡∞µ‡±Ü‡∞§‡±Å‡∞ï‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø -->
    <meta name="keywords" content="Icm church accounts, icm accounts, manugunuru accounts, icm church manugunuru accounts, church ledger manugunuru, manugunuru accounts finance, ICM ledger">
    <meta name="author" content="ICM Church Manugunuru Admin">
    
    <!-- Open Graph for Social Media (WhatsApp/FB) -->
    <meta property="og:title" content="ICM Church Accounts - Official Manugunuru Ledger">
    <meta property="og:description" content="View transparent financial records for ICM Church Manugunuru. Including ICM accounts and Manugunuru accounts ledger.">
    <meta property="og:image" content="https://drive.google.com/thumbnail?id=1UYqySNGlyww8sJcRFA4xLkosdUIu_QAS&sz=w500">
    <meta property="og:url" content="https://icmchurchmanugunuru-cell.github.io/Accounts/">
    <meta property="og:type" content="website">

    <!-- Schema.org for Google Search Results -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "ICM Church Accounts Manugunuru",
      "description": "Official portal for icm church accounts and manugunuru accounts management.",
      "breadcrumb": "ICM Accounts > Manugunuru > Church",
      "url": "https://icmchurchmanugunuru-cell.github.io/Accounts/"
    }
    </script>
    <!-- --- SEO END --- -->
    
    <!-- FAVICON -->
    <link rel="icon" href="https://drive.google.com/thumbnail?id=1UYqySNGlyww8sJcRFA4xLkosdUIu_QAS&sz=w256" type="image/x-icon" />

    <!-- LIBRARIES -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@0.263.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- FIREBASE VERSION 8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; overflow-x: hidden; }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .select-none { user-select: none; -webkit-user-select: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- CONFIGURATION ---
        const ADMIN_PASSWORD = "admin5566"; 
        const AUTHORIZED_EMAIL = "yesububirugadda37@gmail.com"; 
        const LOGO_URL = "https://drive.google.com/thumbnail?id=1UYqySNGlyww8sJcRFA4xLkosdUIu_QAS&sz=w256"; 

        const firebaseConfig = {
          apiKey: "AIzaSyC4DnKQgu0PVVA3Od6JZlSU8g-SyhQ-Zcs",
          authDomain: "icm-church-accounts.firebaseapp.com",
          projectId: "icm-church-accounts",
          storageBucket: "icm-church-accounts.firebasestorage.app",
          messagingSenderId: "306009929571",
          appId: "1:306009929571:web:d8f341735b6fb785a70556"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const Icon = ({ name, size = 24, className = "" }) => {
            const iconHTML = React.useMemo(() => {
                try {
                    const pascalName = name.split('-').map(p => p.charAt(0).toUpperCase() + p.slice(1)).join('');
                    const iconNode = lucide.icons[pascalName] || lucide.icons[name];
                    if (iconNode && typeof iconNode.toSvg === 'function') {
                        return iconNode.toSvg({ class: className, width: size, height: size, 'stroke-width': 2 });
                    }
                } catch (e) { return ''; }
                return '';
            }, [name, size, className]);
            return iconHTML ? <span dangerouslySetInnerHTML={{ __html: iconHTML }} style={{ display: 'inline-flex', alignItems: 'center' }} /> : null;
        };

        const compressImage = (file) => {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const scale = 800 / img.width;
                        canvas.width = 800;
                        canvas.height = img.height * scale;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL('image/jpeg', 0.6));
                    };
                };
            });
        };

        const FinancialChart = ({ income, expense }) => {
            const canvasRef = React.useRef(null);
            const chartInstance = React.useRef(null);
            React.useEffect(() => {
                if (canvasRef.current) {
                    if (chartInstance.current) chartInstance.current.destroy();
                    const ctx = canvasRef.current.getContext('2d');
                    if (income === 0 && expense === 0) return;
                    chartInstance.current = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['‡∞Ü‡∞¶‡∞æ‡∞Ø‡∞Ç', '‡∞ñ‡∞∞‡±ç‡∞ö‡±Å'],
                            datasets: [{ data: [income, expense], backgroundColor: ['#10b981', '#f43f5e'], borderWidth: 0 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { display: false } } }
                    });
                }
                return () => chartInstance.current?.destroy();
            }, [income, expense]);
            return <div className="h-40 w-40 mx-auto relative"><canvas ref={canvasRef}></canvas></div>;
        };

        const App = () => {
            const [user, setUser] = React.useState(null);
            const [transactions, setTransactions] = React.useState([]);
            const [loading, setLoading] = React.useState(true);
            const [showInputForm, setShowInputForm] = React.useState(false);
            const [showInfo, setShowInfo] = React.useState(false);
            const [showChart, setShowChart] = React.useState(false);
            const [viewImage, setViewImage] = React.useState(null);
            
            const [amount, setAmount] = React.useState('');
            const [desc, setDesc] = React.useState('');
            const [type, setType] = React.useState('income');
            const [password, setPassword] = React.useState('');
            const [billImage, setBillImage] = React.useState('');
            const [isSubmitting, setIsSubmitting] = React.useState(false);
            
            const fileInputRef = React.useRef(null);
            const pressTimer = React.useRef(null);
            const [actionItem, setActionItem] = React.useState(null);

            React.useEffect(() => {
                const unsubscribeAuth = auth.onAuthStateChanged((u) => setUser(u));
                const unsubscribeData = db.collection('transactions').orderBy('date', 'desc').onSnapshot(snap => {
                    setTransactions(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                    setLoading(false);
                }, (err) => { setLoading(false); });
                return () => { unsubscribeAuth(); unsubscribeData(); };
            }, []);

            const handleLogin = async () => {
                try {
                    await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
                } catch (e) { alert("Login Failed"); }
            };

            const totalIncome = transactions.filter(t => t.type === 'income').reduce((a, b) => a + Number(b.amount), 0);
            const totalExpense = transactions.filter(t => t.type === 'expense').reduce((a, b) => a + Number(b.amount), 0);
            const balance = totalIncome - totalExpense;
            const formatINR = (n) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(n);
            
            const isAdmin = user && user.email.toLowerCase() === AUTHORIZED_EMAIL.toLowerCase();

            const handleSave = async (e) => {
                e.preventDefault();
                if (!isAdmin) return;
                if (password !== ADMIN_PASSWORD) { alert("üõë ‡∞§‡∞™‡±ç‡∞™‡±Å ‡∞™‡∞æ‡∞∏‡±ç‚Äå‡∞µ‡∞∞‡±ç‡∞°‡±ç!"); return; }
                setIsSubmitting(true);
                try {
                    await db.collection('transactions').add({
                        amount: Number(amount), description: desc, type, image: billImage,
                        date: firebase.firestore.FieldValue.serverTimestamp(),
                        displayDate: new Date().toLocaleDateString('en-GB'),
                        addedBy: user.email
                    });
                    setShowInputForm(false); setAmount(''); setDesc(''); setBillImage(''); setPassword('');
                } catch (e) { alert("Error"); }
                setIsSubmitting(false);
            };

            const handlePressStart = (t) => {
                if (!isAdmin) return;
                pressTimer.current = setTimeout(() => {
                    if(window.navigator.vibrate) window.navigator.vibrate(200);
                    const pwd = prompt("Password to Delete:");
                    if (pwd === ADMIN_PASSWORD) setActionItem(t);
                }, 3000);
            };

            if (loading) return <div className="min-h-screen flex items-center justify-center font-bold">‡∞°‡±á‡∞ü‡∞æ ‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø...</div>;

            return (
                <div className="max-w-md mx-auto bg-slate-50 min-h-screen shadow-xl pb-10">
                    
                    {/* MODALS */}
                    {viewImage && (
                        <div className="fixed inset-0 bg-black z-[100] flex items-center justify-center p-2" onClick={() => setViewImage(null)}>
                            <img src={viewImage} className="max-w-full max-h-full rounded-lg" />
                        </div>
                    )}

                    {showChart && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-md z-50 flex items-center justify-center p-4" onClick={() => setShowChart(false)}>
                            <div className="bg-white w-full max-w-sm rounded-3xl p-6 text-center shadow-2xl" onClick={e => e.stopPropagation()}>
                                <h3 className="text-xl font-bold mb-4">ICM Accounts Status</h3>
                                <FinancialChart income={totalIncome} expense={totalExpense} />
                                <div className="mt-6 flex justify-around font-bold">
                                    <div className="text-emerald-600">In: {formatINR(totalIncome)}</div>
                                    <div className="text-rose-600">Out: {formatINR(totalExpense)}</div>
                                </div>
                                <button onClick={() => setShowChart(false)} className="mt-6 w-full py-2 bg-slate-100 rounded-xl text-slate-400">Close</button>
                            </div>
                        </div>
                    )}

                    {showInfo && (
                        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4" onClick={() => setShowInfo(false)}>
                            <div className="bg-white w-full max-w-sm rounded-2xl p-6 text-center shadow-2xl" onClick={e => e.stopPropagation()}>
                                <img src={LOGO_URL} className="w-20 h-20 mx-auto rounded-full border-4 border-indigo-100 mb-4" />
                                <h2 className="text-xl font-bold text-indigo-900 uppercase tracking-tight">ICM CHURCH</h2>
                                <p className="text-sm text-slate-500 mb-4">Manugunuru Village</p>
                                <div className="space-y-2 mb-6">
                                    <div className="bg-indigo-50 p-2 rounded-lg font-bold text-slate-700">‡∞¨‡∞ø‡∞∑‡∞™‡±ç ‡∞ú‡∞æ‡∞®‡±ç ‡∞é‡∞∏‡±ç ‡∞°‡∞ø ‡∞∞‡∞æ‡∞ú‡±Å ‡∞ó‡∞æ‡∞∞‡±Å</div>
                                    <div className="bg-emerald-50 p-2 rounded-xl font-bold text-slate-700">‡∞∏‡∞æ‡∞≤‡±ç‡∞Æ‡∞®‡±ç ‡∞∞‡∞æ‡∞ú‡±Å ‡∞ó‡∞æ‡∞∞‡±Å</div>
                                </div>
                                <div className="border-t pt-4">
                                    {!user ? (
                                        <button onClick={handleLogin} className="text-sm font-bold text-indigo-600 bg-indigo-50 px-8 py-2.5 rounded-full shadow-md">Admin Login</button>
                                    ) : (
                                        <div className="text-center">
                                            <p className="text-[10px] text-slate-400 mb-2">Login: {user.email}</p>
                                            {isAdmin ? <p className="text-emerald-600 font-bold text-xs mb-3">‚úÖ Admin Active</p> : <p className="text-rose-500 font-bold text-xs mb-3 p-1 bg-rose-50 rounded">‚ùå No Access</p>}
                                            <button onClick={() => auth.signOut()} className="text-sm font-bold text-rose-600 bg-rose-50 px-8 py-2 rounded-full">Logout</button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {actionItem && (
                        <div className="fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4" onClick={() => setActionItem(null)}>
                            <div className="bg-white w-full max-w-xs rounded-2xl p-6 text-center shadow-2xl" onClick={e => e.stopPropagation()}>
                                <p className="font-bold mb-4">Delete Entry?</p>
                                <button onClick={async () => { if(confirm("Confirm Delete?")) await db.collection('transactions').doc(actionItem.id).delete(); setActionItem(null); }} className="w-full py-3 bg-rose-50 text-rose-600 rounded-xl font-bold">Yes, Delete</button>
                                <button onClick={() => setActionItem(null)} className="w-full mt-2 py-2 text-slate-400">Cancel</button>
                            </div>
                        </div>
                    )}

                    {/* HEADER */}
                    <header className="bg-indigo-700 text-white p-6 rounded-b-[2.5rem] shadow-xl text-center relative z-0">
                        <div className="flex justify-between items-center mb-6">
                            <img src={LOGO_URL} className="w-12 h-12 bg-white rounded-lg p-0.5 cursor-pointer shadow-md hover:scale-105 transition" onClick={() => setShowInfo(true)} />
                            <div className="text-right">
                                <h1 className="font-bold text-lg tracking-tight">ICM CHURCH</h1>
                                <p className="text-[10px] opacity-60">Manugunuru Ledger</p>
                            </div>
                        </div>
                        <p className="text-[10px] opacity-60 uppercase font-bold tracking-widest mb-1">Treasury Balance</p>
                        <h2 className="text-5xl font-bold mb-6 drop-shadow-md">{formatINR(balance)}</h2>
                        <div className="grid grid-cols-2 gap-3">
                            <div className="glass p-3 rounded-2xl"><p className="text-[10px] text-emerald-300 font-bold uppercase tracking-wide">Inflow</p><p className="text-lg font-bold">{formatINR(totalIncome)}</p></div>
                            <div className="glass p-3 rounded-2xl"><p className="text-[10px] text-rose-300 font-bold uppercase tracking-wide">Outflow</p><p className="text-lg font-bold">{formatINR(totalExpense)}</p></div>
                        </div>
                        <button onClick={() => setShowChart(true)} className="mt-6 text-[10px] bg-white/10 px-6 py-2 rounded-full border border-white/20 font-bold uppercase tracking-widest hover:bg-white/20 transition">View Analytics üìä</button>
                    </header>

                    {/* ADMIN BUTTON */}
                    {isAdmin && !showInputForm && (
                        <div className="flex justify-center -mt-6 relative z-10">
                            <button onClick={() => setShowInputForm(true)} className="bg-white text-indigo-700 px-8 py-3 rounded-full shadow-2xl font-bold text-sm border-2 border-indigo-50 hover:scale-105 transition flex items-center gap-2">
                                <Icon name="plus-circle" size={18} /> Add Entry
                            </button>
                        </div>
                    )}

                    {/* INPUT FORM */}
                    {isAdmin && showInputForm && (
                        <section className="p-4 animate-fade-in relative z-20">
                            <div className="bg-white rounded-3xl shadow-2xl p-6 border border-indigo-100">
                                <div className="flex gap-2 mb-4 bg-slate-100 p-1 rounded-2xl">
                                    <button type="button" onClick={() => setType('income')} className={`flex-1 py-2.5 rounded-xl text-xs font-bold transition-all ${type === 'income' ? 'bg-emerald-500 text-white shadow-md' : 'text-slate-400'}`}>INCOME</button>
                                    <button type="button" onClick={() => setType('expense')} className={`flex-1 py-2.5 rounded-xl text-xs font-bold transition-all ${type === 'expense' ? 'bg-rose-500 text-white shadow-md' : 'text-slate-400'}`}>EXPENSE</button>
                                </div>
                                <form onSubmit={handleSave} className="space-y-4">
                                    <input type="number" placeholder="Amount (‚Çπ)" className="w-full p-4 bg-slate-50 rounded-2xl outline-none border focus:border-indigo-400 font-bold text-lg" value={amount} onChange={e => setAmount(e.target.value)} required />
                                    <input type="text" placeholder="Description / Person" className="w-full p-4 bg-slate-50 rounded-2xl outline-none border focus:border-indigo-400" value={desc} onChange={e => setDesc(e.target.value)} required />
                                    
                                    <div className="flex gap-2">
                                        <button type="button" onClick={() => fileInputRef.current.click()} className={`flex-1 py-3 rounded-2xl border-2 border-dashed text-xs font-bold transition-all ${billImage ? 'bg-emerald-50 border-emerald-400 text-emerald-600' : 'text-slate-400 border-slate-200'}`}>
                                            <Icon name={billImage ? "check-circle" : "camera"} size={16} /> {billImage ? "Bill Added" : "Upload Bill Photo"}
                                        </button>
                                        {billImage && <button type="button" onClick={() => setBillImage('')} className="p-3 bg-rose-50 text-rose-500 rounded-2xl"><Icon name="trash-2" size={16} /></button>}
                                        <input type="file" ref={fileInputRef} onChange={async e => setBillImage(await compressImage(e.target.files[0]))} className="hidden" accept="image/*" />
                                    </div>

                                    <input type="password" placeholder="Admin Password" className="w-full p-4 bg-indigo-50 rounded-2xl outline-none border-2 border-indigo-100 font-mono text-sm" value={password} onChange={e => setPassword(e.target.value)} required />

                                    <div className="flex gap-3 pt-2">
                                        <button type="button" onClick={() => setShowInputForm(false)} className="flex-1 py-4 font-bold text-slate-400 hover:text-slate-600 transition">Cancel</button>
                                        <button className="flex-[2] py-4 bg-indigo-600 text-white rounded-2xl font-bold shadow-lg" disabled={isSubmitting}>{isSubmitting ? 'Saving...' : 'SAVE DATA'}</button>
                                    </div>
                                </form>
                            </div>
                        </section>
                    )}

                    {/* HISTORY LIST */}
                    <main className="p-4 space-y-3 mt-4">
                        <div className="flex items-center justify-between px-2 mb-4">
                            <h3 className="text-xs font-bold text-slate-400 uppercase tracking-widest flex items-center gap-1"><Icon name="history" size={12} /> Transaction History</h3>
                            <span className="text-[10px] bg-slate-200 text-slate-500 px-2 py-0.5 rounded-full font-bold">MANUGUNURU ACCOUNTS</span>
                        </div>

                        {transactions.length === 0 ? (
                            <div className="text-center py-20 opacity-30 flex flex-col items-center"><Icon name="wallet" size={48} /><p className="mt-2 font-medium">No records</p></div>
                        ) : (
                            <div className="space-y-3">
                                {transactions.map(t => (
                                    <div key={t.id} className="bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center border border-slate-100 active:bg-slate-50 transition-colors select-none"
                                        onMouseDown={() => handlePressStart(t)} onMouseUp={() => clearTimeout(pressTimer.current)} onMouseLeave={() => clearTimeout(pressTimer.current)}
                                        onTouchStart={() => handlePressStart(t)} onTouchEnd={() => clearTimeout(pressTimer.current)}
                                    >
                                        <div className="flex items-center gap-3">
                                            <div className={`p-2.5 rounded-full ${t.type === 'income' ? 'bg-emerald-50 text-emerald-600' : 'bg-rose-50 text-rose-600'}`}>
                                                <Icon name={t.type === 'income' ? 'trending-up' : 'trending-down'} size={18} />
                                            </div>
                                            <div>
                                                <h4 className="font-bold text-slate-800 text-sm leading-tight">{t.description}</h4>
                                                <p className="text-[10px] text-slate-400 mt-1">{t.displayDate}</p>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            {t.image && <button onClick={(e) => { e.stopPropagation(); setViewImage(t.image); }} className="p-2 bg-indigo-50 text-indigo-600 rounded-full hover:bg-indigo-100 transition shadow-sm"><Icon name="image" size={14} /></button>}
                                            <p className={`font-bold text-sm ${t.type === 'income' ? 'text-emerald-600' : 'text-rose-600'}`}>{t.type === 'income' ? '+' : '-'} {formatINR(t.amount)}</p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    <footer className="text-center text-slate-300 text-[10px] py-10 px-6 border-t border-slate-100 mt-10">
                        <p className="font-semibold uppercase tracking-widest mb-1">ICM Church Manugunuru Village</p>
                        <p className="italic">ICM Accounts | Manugunuru Accounts | Digital Ledger</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
